# Copyright (C) 2016 Branden Archer <b.m.archer4@gmail.com>
# Copyright (C) 2016 Joshua D. Boyd <jdboyd@jdboyd.net>
# Copyright (C) 2016 Nicola Spanti  <dev@nicola-spanti.info>
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 2.1 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the
# Free Software Foundation, Inc., 59 Temple Place - Suite 330,
# Boston, MA 02111-1307, USA.


language: c

os:
  - linux
  - osx

compiler:
  - gcc
  - clang

env:
  - USE_CMAKE=YES
  - USE_CMAKE=NO

addons:
  apt:
    packages:
      - texinfo
      - vera++

matrix:
  exclude:
  # There have been sporadic unit test failures with
  # timeout tests on OSX using CMake. Until these are
  # resolved, skipping these tests.
  - os: osx
    env: USE_CMAKE=YES

script:
  - if [ ${TRAVIS_OS_NAME} = 'linux' ]; then vera++ --error -R F001 -R F002 -P max-filename-length=40 -R L004 -P max-line-length=90 -R L005 -P max-consecutive-empty-lines=2 -R L006 -P max-file-length=1000 -R T001 -R T009 $(find src \( -name '*.h' -o -name '*.c' \)); fi
  - mkdir build
  - cd build
  - if [ $USE_CMAKE == 'YES' ] ; then cmake .. ; fi
  - if [ $USE_CMAKE == 'NO' ] ; then pushd .. ; autoreconf -i ; popd; fi
  - if [ $USE_CMAKE == 'NO' ] ; then ../configure ; fi
  - make
  - if [ $USE_CMAKE == 'YES' ] ; then CTEST_OUTPUT_ON_FAILURE=1 make test ; fi
  - if [ $USE_CMAKE == 'NO' ] ; then make check ; fi
